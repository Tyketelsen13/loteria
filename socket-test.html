<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.IO Test - Loteria</title>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 4px; font-family: monospace; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .status.connected { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.disconnected { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .input-group { margin: 10px 0; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .input-group input { padding: 8px; width: 200px; border: 1px solid #ccc; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Loteria Socket.IO Test</h1>
        
        <div id="status" class="status disconnected">Disconnected</div>
        
        <div class="input-group">
            <label for="playerName">Player Name:</label>
            <input type="text" id="playerName" value="Test Player" />
        </div>
        
        <div class="input-group">
            <label for="playerEmail">Player Email:</label>
            <input type="email" id="playerEmail" value="test@example.com" />
        </div>
        
        <div>
            <button onclick="connect()">Connect to Socket.IO</button>
            <button onclick="disconnect()">Disconnect</button>
            <button onclick="createLobby()">Create Lobby</button>
            <button onclick="startGame()">Start Game</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>
        
        <div id="currentLobby" style="display: none;">
            <h3>Current Lobby: <span id="lobbyCode"></span></h3>
            <p>Players: <span id="playerCount">0</span></p>
        </div>
        
        <h3>Event Log:</h3>
        <div id="log" class="log">Ready to test Socket.IO connection...</div>
    </div>

    <script>
        let socket = null;
        let currentLobbyCode = null;
        
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateStatus(connected) {
            const statusDiv = document.getElementById('status');
            if (connected) {
                statusDiv.textContent = `Connected (ID: ${socket.id})`;
                statusDiv.className = 'status connected';
            } else {
                statusDiv.textContent = 'Disconnected';
                statusDiv.className = 'status disconnected';
            }
        }
        
        function connect() {
            if (socket && socket.connected) {
                log('‚ùå Already connected!');
                return;
            }
            
            log('üîå Connecting to Socket.IO server...');
            
            socket = io('http://localhost:3001', {
                path: '/api/socket/io',
                transports: ['polling', 'websocket']
            });
            
            socket.on('connect', () => {
                log('‚úÖ Connected successfully!');
                updateStatus(true);
            });
            
            socket.on('disconnect', (reason) => {
                log(`‚ùå Disconnected: ${reason}`);
                updateStatus(false);
            });
            
            socket.on('connect_error', (error) => {
                log(`üî¥ Connection error: ${error.message}`);
                updateStatus(false);
            });
            
            socket.on('lobby-created', (data) => {
                log(`üé™ Lobby created: ${data.lobbyCode}`);
                currentLobbyCode = data.lobbyCode;
                document.getElementById('lobbyCode').textContent = data.lobbyCode;
                document.getElementById('playerCount').textContent = data.lobby.players.length;
                document.getElementById('currentLobby').style.display = 'block';
            });
            
            socket.on('game-started', (data) => {
                log(`üéØ GAME STARTED! Lobby: ${data.lobbyCode}`);
                log(`üìã Players: ${data.players.length}`);
                log(`‚öôÔ∏è Settings: ${JSON.stringify(data.settings)}`);
                log(`üéÆ This is where your frontend should navigate to the game board!`);
            });
            
            socket.on('game-start-confirmed', (data) => {
                log(`‚úÖ Game start confirmed: ${data.message}`);
            });
            
            socket.on('error', (error) => {
                log(`‚ùå Socket error: ${error.message}`);
            });
            
            // Log all events for debugging
            socket.onAny((eventName, ...args) => {
                log(`üì• Event received: ${eventName} - ${JSON.stringify(args)}`);
            });
        }
        
        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
                currentLobbyCode = null;
                document.getElementById('currentLobby').style.display = 'none';
                log('üîå Disconnected manually');
            }
        }
        
        function createLobby() {
            if (!socket || !socket.connected) {
                log('‚ùå Not connected! Connect first.');
                return;
            }
            
            const playerName = document.getElementById('playerName').value;
            const playerEmail = document.getElementById('playerEmail').value;
            
            if (!playerName || !playerEmail) {
                log('‚ùå Please enter player name and email');
                return;
            }
            
            log(`üé™ Creating lobby for ${playerName}...`);
            socket.emit('create-lobby', { playerName, playerEmail });
        }
        
        function startGame() {
            if (!socket || !socket.connected) {
                log('‚ùå Not connected! Connect first.');
                return;
            }
            
            if (!currentLobbyCode) {
                log('‚ùå No lobby! Create a lobby first.');
                return;
            }
            
            log(`üéÆ Starting game in lobby ${currentLobbyCode}...`);
            socket.emit('start-game', { lobbyCode: currentLobbyCode });
        }
        
        function clearLog() {
            document.getElementById('log').textContent = 'Log cleared...\n';
        }
    </script>
</body>
</html>
